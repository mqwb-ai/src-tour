<elevenlabs-convai agent-id="agent_01jvn5j7m7emj9mva27qc019fy"></elevenlabs-convai>
<script src="https://elevenlabs.io/convai-widget/index.js" async type="text/javascript"></script>

<elevenlabs-convai
  id="convai-widget"
  agent-id="agent_01jvn5j7m7emj9mva27qc019fy"
  auto-start="false">
</elevenlabs-convai>
<script src="https://elevenlabs.io/convai-widget/index.js" async type="text/javascript"></script>

<script>
  window.addEventListener('DOMContentLoaded', () => {
    const widget = document.getElementById('convai-widget');

    const waitForWidgetReady = () =>
      new Promise((resolve) => {
        const check = () => {
          if (widget && typeof widget.start === 'function') {
            resolve();
          } else {
            setTimeout(check, 100);
          }
        };
        check();
      });

    waitForWidgetReady().then(() => {
      // Attach a one-time click handler
      widget.addEventListener('click', () => {
        if (!widget.hasStarted) {
          // Register tools before starting the session
          widget.clientTools = {
            logMessage: async ({ message }) => {
              console.log('logMessage on click:', message);
            }
          };

          widget.start();
          widget.hasStarted = true; // flag to avoid double start
          console.log('Client tools registered and session started on click.');
        }
      });
    });
  });
</script>
